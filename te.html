// import { Tabs } from 'expo-router';
// import React from 'react';
// import { View, Text, Image, TouchableOpacity, StyleSheet } from 'react-native';
// import { SafeAreaView } from 'react-native-safe-area-context';

// import { HapticTab } from '@/components/haptic-tab';
// import { IconSymbol } from '@/components/ui/icon-symbol';
// import { Colors } from '@/constants/theme';
// import { useColorScheme } from '@/hooks/use-color-scheme';

// export default function TabLayout() {
//   const colorScheme = useColorScheme();

//   // Custom top header
//   const renderHeader = () => (
//     <SafeAreaView edges={['top']} style={styles.safeHeader}>
//       <View style={styles.header}>
//         {/* Sidebar / Menu button */}
//         <TouchableOpacity onPress={() => console.log('Open sidebar')}>
//           <IconSymbol name="line.horizontal.3" size={28} color="#fff" />
//         </TouchableOpacity>

//         {/* App title */}
//         <Text style={styles.title}>WICIKI</Text>

//         {/* Profile picture */}
//         <TouchableOpacity onPress={() => console.log('Go to profile')}>
//           <Image
//             source={{ uri: 'https://randomuser.me/api/portraits/men/32.jpg' }}
//             style={styles.avatar}
//           />
//         </TouchableOpacity>
//       </View>
//     </SafeAreaView>
//   );

//   return (

// <Tabs
//   screenOptions={{
//     tabBarActiveTintColor: Colors[colorScheme ?? 'light'].tint,
//     tabBarButton: HapticTab,
//     header: renderHeader,
//     tabBarStyle: {
//       backgroundColor: "#0b0b0b",
//       borderBottomColor: 'rgba(255,255,255,0.1)',
//     },
//   }}

// >
//   <Tabs.Screen
//     name="index"
//     options={{
//       title: 'Home',
//       tabBarIcon: ({ color }) => <IconSymbol size={28} name="house.fill" color={color} />,
//     }}
//   />
//   <Tabs.Screen
//     name="explore"
//     options={{
//       title: 'Explore',
//       tabBarIcon: ({ color }) => <IconSymbol size={28} name="paperplane.fill" color={color} />,
//     }}
//   />
// </Tabs >
//   );
// }

// const styles = StyleSheet.create({
//   safeHeader: {
//     backgroundColor: '#0b0b0b',
//   },
//   header: {
//     height: 60,
//     flexDirection: 'row',
//     alignItems: 'center',
//     justifyContent: 'space-between',
//     paddingHorizontal: 12,
//     borderBottomWidth: 1,
//     borderBottomColor: 'rgba(255,255,255,0.1)',
//   },
//   title: { color: '#fff', fontSize: 18, fontWeight: 'bold' },
//   avatar: { width: 36, height: 36, borderRadius: 18 },
// });




































// app/(tabs)/_layout.js
import { Picker } from "@react-native-picker/picker";
import { HapticTab } from "@/components/haptic-tab";
import { Colors } from "@/constants/theme";
import { useColorScheme } from "@/hooks/use-color-scheme";
import { MaterialCommunityIcons } from '@expo/vector-icons';
import { Tabs, usePathname, useRouter } from "expo-router";
import React, { useRef, useState, useEffect, useCallback } from "react";
import { Switch, TextInput } from "react-native";
import {
  Animated,
  Dimensions,
  Image,
  PanResponder,
  Pressable,
  ScrollView,
  StyleSheet,
  Text,
  TouchableOpacity,
  View,
  Platform,
} from "react-native";
import { SafeAreaView } from "react-native-safe-area-context";
import AsyncStorage from "@react-native-async-storage/async-storage";
import { Alert } from "react-native";

const SCREEN_WIDTH = Dimensions.get("window").width;
const DRAWER_WIDTH = SCREEN_WIDTH; // full screen width drawer
const EDGE_ACTIVATE_WIDTH = 22; // left-edge activation for opening drawer
const TAB_SWIPE_MIN_DISTANCE = 50;
const TAB_SWIPE_VELOCITY = 0.25;
const H_MOVE_THRESHOLD = 6;

export default function TabLayout() {
  const router = useRouter();
  const pathname = usePathname?.() ?? "/";
  const colorScheme = useColorScheme?.() ?? "light";

  // Tabs order (must match your Tabs.Screen names/paths)
  const tabs = ["/", "/explore"];
  const currentIndex = Math.max(0, tabs.indexOf(pathname) || 0);

  // Drawer animation & state
  const translateX = useRef(new Animated.Value(-DRAWER_WIDTH)).current;
  const [isOpen, setIsOpen] = useState(false);
  let size = 25;
  // Drawer internal tab state (top horizontal nav inside drawer)
  const drawerNavItems = [
    {
      key: "Privacy&Security",
      label: "Privacy",
      icon: <MaterialCommunityIcons size={size} name="shield-account" color={"#fff"} />
    },
    {
      key: "AccountSettings",
      label: "Account info",
      icon: <MaterialCommunityIcons size={size} name="account-circle" color={"#fff"} />
    },
    {
      key: "notifications",
      label: "Notifications",
      icon: <MaterialCommunityIcons size={size} name="bell" color={"#fff"} />
    },
    {
      key: "Appearance",
      label: "Appearance",
      icon: <MaterialCommunityIcons size={size} name="palette" color={"#fff"} />
    },
  ];
  const [drawerActiveTab, setDrawerActiveTab] = useState(drawerNavItems[0].key);

  // temp drag value
  const dragOffset = useRef(0);
  const gestureType = useRef("none"); // "none" | "drawer" | "tabs"

  const openDrawer = (duration = 240) => {
    setIsOpen(true);
    Animated.timing(translateX, {
      toValue: 0,
      duration,
      useNativeDriver: true,
    }).start();
  };

  const closeDrawer = (duration = 240) => {
    Animated.timing(translateX, {
      toValue: -DRAWER_WIDTH,
      duration,
      useNativeDriver: true,
    }).start(() => setIsOpen(false));
  };

  const navigateTo = (path) => {
    closeDrawer();
    setTimeout(() => router.push(path), 160);
  };

  const goToIndex = (index) => {
    if (index < 0 || index >= tabs.length) return;
    router.push(tabs[index]);
  };

  // PanResponder handles both drawer swipe and tab swipe
  const panResponder = useRef(
    PanResponder.create({
      onStartShouldSetPanResponder: () => false,
      onMoveShouldSetPanResponder: (evt, gs) => {
        const { dx, dy, x0 } = gs;
        if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > H_MOVE_THRESHOLD) {
          if (isOpen) return true;
          if (x0 <= EDGE_ACTIVATE_WIDTH && dx > 0) return true;
          return true;
        }
        return false;
      },
      onPanResponderGrant: () => {
        gestureType.current = "none";
        dragOffset.current = 0;
      },
      onPanResponderMove: (evt, gs) => {
        const { dx, x0 } = gs;
        if (gestureType.current === "none") {
          if (isOpen) gestureType.current = "drawer";
          else {
            if (x0 <= EDGE_ACTIVATE_WIDTH && dx > 0) gestureType.current = "drawer";
            else gestureType.current = "tabs";
          }
        }

        if (gestureType.current === "drawer") {
          const base = isOpen ? 0 : -DRAWER_WIDTH;
          let newX = base + dx;
          newX = Math.max(-DRAWER_WIDTH, Math.min(0, newX));
          translateX.setValue(newX);
          dragOffset.current = dx;
        } else if (gestureType.current === "tabs") {
          dragOffset.current = dx;
          // no content translation to avoid interfering with screen internals
        }
      },
      onPanResponderRelease: (evt, gs) => {
        const { dx, vx } = gs;
        const absDx = Math.abs(dx);

        if (gestureType.current === "drawer") {
          const shouldOpen =
            (!isOpen && (dx > DRAWER_WIDTH / 3 || vx > 0.3)) ||
            (isOpen && !(dx < -DRAWER_WIDTH / 3 || vx < -0.3));
          if (shouldOpen) openDrawer();
          else closeDrawer();
        } else if (gestureType.current === "tabs") {
          if (absDx > TAB_SWIPE_MIN_DISTANCE || Math.abs(vx) > TAB_SWIPE_VELOCITY) {
            if (dx < 0) goToIndex(currentIndex + 1);
            else goToIndex(currentIndex - 1);
          }
        }

        dragOffset.current = 0;
        gestureType.current = "none";
      },
      onPanResponderTerminate: () => {
        if (isOpen) openDrawer(); else closeDrawer();
        gestureType.current = "none";
        dragOffset.current = 0;
      },
    })
  ).current;



  const [loading, setloading] = useState<boolean>(true)
  type SettingsState = {
    pushNotifications: boolean;
    emailNotifications: boolean;
    soundEnabled: boolean;
    profileVisibility: string;
    twoFactorAuth: boolean;
    loginAlerts: boolean;
    fontSize: string;
    reduceMotion: boolean;
    imageQuality: string;
    Deactivate: boolean;
    projectsCompleted: String;
    profession: String;
    bio: String;
    yearsExperience: String;
  };

  const [settings, setSettings] = useState<SettingsState>({
    pushNotifications: false,
    emailNotifications: false,
    soundEnabled: false,
    profileVisibility: "public",
    twoFactorAuth: false,
    loginAlerts: false,
    fontSize: "medium",
    reduceMotion: false,
    imageQuality: "high",
    Deactivate: false,
    profession: "",
    projectsCompleted: "0",
    bio: "",
    yearsExperience: "",
  });


































  const [saving, setSaving] = useState<boolean>(false)


  useEffect(() => {
    (async () => {
      try {
        const raw = await AsyncStorage.getItem('auth_token');
        if (raw) {
          const parsed = JSON.parse(raw) as Partial<SettingsState>;
          setSettings((s) => ({ ...s, ...parsed }));
        }
      } catch (e) {
        console.warn("Failed to load settings", e);
      }
    })();
  }, []);
  let STORAGE_KEY = 'auth_token';

  // Save helper
  const persist = useCallback(async (newSettings: SettingsState) => {
    setSaving(true);
    try {
      await AsyncStorage.setItem(STORAGE_KEY, JSON.stringify(newSettings));
      setSettings(newSettings);
      // small UX feedback
      setTimeout(() => {
        setSaving(false);
        Alert.alert("Settings saved", "Your preferences were saved successfully.");
      }, 400);
    } catch (e) {
      setSaving(false);
      console.warn("Failed to save settings", e);
      Alert.alert("Error", "Could not save settings. Try again.");
    }
  }, []);

  // Update a single key + persist
  const updateAndSave = useCallback(
    async <K extends keyof SettingsState>(key: K, value: SettingsState[K]) => {
      const updated = { ...settings, [key]: value };
      await persist(updated);
    },
    [settings, persist]
  );



  const renderDrawerContent = () => {
    switch (drawerActiveTab) {
      case "Privacy&Security":
        return (
          <ScrollView style={settingsstyle.contentPane} contentContainerStyle={{ paddingBottom: 40 }}>
            <Text style={settingsstyle.paneTitle}>Privacy & Security</Text>

            <View style={settingsstyle.row}>
              <Text style={settingsstyle.label}>Profile Visibility</Text>
              <Text style={settingsstyle.value}>{settings.profileVisibility}</Text>
            </View>

            <View style={settingsstyle.card}>
              <Text style={settingsstyle.cardTitleSmall}>Who can see your profile?</Text>
              <View style={settingsstyle.pickerWrap}>
                <Picker
                  selectedValue={settings.profileVisibility}
                  onValueChange={(val) => updateAndSave("profileVisibility", val as any)}
                  style={settingsstyle.picker}
                  dropdownIconColor="#fff"
                >
                  <Picker.Item label="Everyone" value="Everyone" />
                  <Picker.Item label="Friends" value="Friends" />
                  <Picker.Item label="Only Me" value="Only Me" />
                </Picker>
              </View>
            </View>

            <View style={settingsstyle.row}>
              <Text style={settingsstyle.label}>Two Factor Auth</Text>
              <Switch
                value={settings.twoFactorAuth}
                onValueChange={(v) => updateAndSave("twoFactorAuth", v)}
                trackColor={{ false: "#666", true: "#ff4b4b" }}
                thumbColor={Platform.OS === "android" ? (settings.twoFactorAuth ? "#fff" : "#fff") : undefined}
              />
            </View>

            <View style={settingsstyle.row}>
              <Text style={settingsstyle.label}>Login Alerts</Text>
              <Switch
                value={settings.loginAlerts}
                onValueChange={(v) => updateAndSave("loginAlerts", v)}
                trackColor={{ false: "#666", true: "#ff4b4b" }}
                thumbColor={Platform.OS === "android" ? (settings.loginAlerts ? "#fff" : "#fff") : undefined}
              />
            </View>

            <View style={{ marginTop: 10 }}>
              <Text style={settingsstyle.cardTitleSmall}>Bio</Text>
              <TextInput
                placeholder="Tell people about yourself..."
                placeholderTextColor="#cfcfcf"
                style={settingsstyle.textInput}
                value={settings.bio}
                onChangeText={(t) => setSettings((s) => ({ ...s, bio: t }))}
                multiline
                numberOfLines={4}
              />
            </View>

            <TouchableOpacity
              style={[settingsstyle.actionBtn, { marginTop: 14 }]}
              activeOpacity={0.85}
              onPress={() => persist(settings)}
            >
              <Text style={settingsstyle.actionBtnText}>{saving ? "Saving..." : "Save Privacy"}</Text>
            </TouchableOpacity>
          </ScrollView>
        );

      case "AccountSettings":
        return (
          <ScrollView style={settingsstyle.contentPane} contentContainerStyle={{ paddingBottom: 40 }}>
            <Text style={settingsstyle.paneTitle}>Professional Information</Text>

            <Text style={[settingsstyle.label, { marginTop: 6 }]}>Profession</Text>
            <TextInput
              style={settingsstyle.fieldInput}
              placeholder="e.g. Software Engineer"
              placeholderTextColor="#cfcfcf"
              value={settings.profession}
              onChangeText={(t) => setSettings((s) => ({ ...s, profession: t }))}
            />

            <Text style={[settingsstyle.label, { marginTop: 10 }]}>Years of Experience</Text>
            <TextInput
              style={settingsstyle.fieldInput}
              placeholder="e.g. 3"
              keyboardType="numeric"
              placeholderTextColor="#cfcfcf"
              value={settings.yearsExperience}
              onChangeText={(t) => setSettings((s) => ({ ...s, yearsExperience: t }))}
            />

            <Text style={[settingsstyle.label, { marginTop: 10 }]}>Projects Completed</Text>
            <TextInput
              style={settingsstyle.fieldInput}
              placeholder="e.g. 12"
              keyboardType="numeric"
              placeholderTextColor="#cfcfcf"
              value={settings.projectsCompleted}
              onChangeText={(t) => setSettings((s) => ({ ...s, projectsCompleted: t }))}
            />

            <TouchableOpacity
              style={[settingsstyle.actionBtn, { marginTop: 14 }]}
              activeOpacity={0.85}
              onPress={() => persist(settings)}
            >
              <Text style={settingsstyle.actionBtnText}>{saving ? "Saving..." : "Save Work Info"}</Text>
            </TouchableOpacity>
          </ScrollView>
        );

      case "notifications":
        return (
          <ScrollView style={settingsstyle.contentPane} contentContainerStyle={{ paddingBottom: 40 }}>
            <Text style={settingsstyle.paneTitle}>Notifications</Text>

            <View style={settingsstyle.row}>
              <Text style={settingsstyle.label}>Push Notifications</Text>
              <Switch
                value={settings.pushNotifications}
                onValueChange={(v) => updateAndSave("pushNotifications", v)}
                trackColor={{ false: "#666", true: "#ff4b4b" }}
                thumbColor={Platform.OS === "android" ? (settings.pushNotifications ? "#fff" : "#fff") : undefined}
              />
            </View>

            <View style={settingsstyle.row}>
              <Text style={settingsstyle.label}>Email & SMS</Text>
              <Switch
                value={settings.emailNotifications}
                onValueChange={(v) => updateAndSave("emailNotifications", v)}
                trackColor={{ false: "#666", true: "#ff4b4b" }}
                thumbColor={Platform.OS === "android" ? (settings.emailNotifications ? "#fff" : "#fff") : undefined}
              />
            </View>

            <View style={settingsstyle.row}>
              <Text style={settingsstyle.label}>Notification Sounds</Text>
              <Switch
                value={settings.soundEnabled}
                onValueChange={(v) => updateAndSave("soundEnabled", v)}
                trackColor={{ false: "#666", true: "#ff4b4b" }}
                thumbColor={Platform.OS === "android" ? (settings.soundEnabled ? "#fff" : "#fff") : undefined}
              />
            </View>

            <TouchableOpacity
              style={[settingsstyle.actionBtn, { marginTop: 14 }]}
              activeOpacity={0.85}
              onPress={() => persist(settings)}
            >
              <Text style={settingsstyle.actionBtnText}>{saving ? "Saving..." : "Save Notifications"}</Text>
            </TouchableOpacity>
          </ScrollView>
        );

      case "Appearance":
        return (
          <ScrollView style={settingsstyle.contentPane} contentContainerStyle={{ paddingBottom: 40 }}>
            <Text style={settingsstyle.paneTitle}>Appearance</Text>

            <View style={settingsstyle.row}>
              <Text style={settingsstyle.label}>Font Size</Text>
              <Text style={settingsstyle.value}>{settings.fontSize}</Text>
            </View>

            <View style={settingsstyle.card}>
              <Text style={settingsstyle.cardTitleSmall}>Select font size</Text>
              <View style={settingsstyle.pickerWrap}>
                <Picker
                  selectedValue={settings.fontSize}
                  onValueChange={(v) => updateAndSave("fontSize", v as any)}
                  style={settingsstyle.picker}
                  dropdownIconColor="#fff"
                >
                  <Picker.Item label="Small" value="Small" />
                  <Picker.Item label="Medium" value="Medium" />
                  <Picker.Item label="Large" value="Large" />
                </Picker>
              </View>
            </View>

            <View style={settingsstyle.row}>
              <Text style={settingsstyle.label}>Reduce Motion</Text>
              <Switch
                value={settings.reduceMotion}
                onValueChange={(v) => updateAndSave("reduceMotion", v)}
                trackColor={{ false: "#666", true: "#ff4b4b" }}
                thumbColor={Platform.OS === "android" ? (settings.reduceMotion ? "#fff" : "#fff") : undefined}
              />
            </View>

            <View style={settingsstyle.card}>
              <Text style={settingsstyle.cardTitleSmall}>Image & Video Quality</Text>
              <View style={settingsstyle.pickerWrap}>
                <Picker
                  selectedValue={settings.imageQuality}
                  onValueChange={(v) => updateAndSave("imageQuality", v as any)}
                  style={settingsstyle.picker}
                  dropdownIconColor="#fff"
                >
                  <Picker.Item label="Low" value="Low" />
                  <Picker.Item label="Medium" value="Medium" />
                  <Picker.Item label="High" value="High" />
                </Picker>
              </View>
            </View>

            <TouchableOpacity
              style={[settingsstyle.actionBtn, { marginTop: 14 }]}
              activeOpacity={0.85}
              onPress={() => persist(settings)}
            >
              <Text style={settingsstyle.actionBtnText}>{saving ? "Saving..." : "Save Appearance"}</Text>
            </TouchableOpacity>
          </ScrollView>
        );

      default:
        return (
          <View style={settingsstyle.contentPane}>
            <Text style={settingsstyle.paneTitle}>Unknown</Text>
          </View>
        );
    }
  };



  const settingsstyle = StyleSheet.create({
    drawerContent: { flex: 1, paddingHorizontal: 16, paddingVertical: 8 },
    contentPane: { paddingVertical: 8 },
    paneTitle: { color: "#fff", fontSize: 18, fontWeight: "700", marginBottom: 8 },
    paneText: { color: "#d6d6d6", fontSize: 14, lineHeight: 20 },
    row: { flexDirection: "row", justifyContent: "space-between", alignItems: "center", marginBottom: 12 },
    label: { color: "#d6d6d6", fontSize: 14 },
    value: { color: "#fff", fontSize: 14, fontWeight: "600" },

    picker: {
      color: "#fff",
      ...(Platform.OS === "ios" ? { height: 140 } : {}),
    },
    pickerWrap: {
      backgroundColor: "#120909",
      borderRadius: 8,
      overflow: "hidden",
      marginTop: 8,
    },

    card: {
      backgroundColor: "#0b0b0b",
      padding: 12,
      borderRadius: 10,
      marginBottom: 12,
    },

    cardTitleSmall: {
      color: "#fff",
      fontSize: 13,
      fontWeight: "600",
    },

    textInput: {
      marginTop: 8,
      backgroundColor: "#121212",
      color: "#fff",
      borderRadius: 8,
      padding: 10,
      minHeight: 90,
      textAlignVertical: "top",
    },

    fieldInput: {
      marginTop: 6,
      backgroundColor: "#121212",
      color: "#fff",
      borderRadius: 8,
      paddingHorizontal: 12,
      paddingVertical: Platform.OS === "ios" ? 12 : 8,
    },

    actionBtn: {
      marginTop: 12,
      backgroundColor: "#7b1f1f",
      paddingVertical: 10,
      paddingHorizontal: 14,
      borderRadius: 8,
      alignItems: "center",
    },
    actionBtnText: { color: "#fff", fontWeight: "700" },

    tabRow: { flexDirection: "row", padding: 8, backgroundColor: "#0a0a0a" },
    tabBtn: {
      paddingVertical: 8,
      paddingHorizontal: 12,
      marginRight: 8,
      borderRadius: 8,
      backgroundColor: "#1a1a1a",
    },
    tabBtnActive: { backgroundColor: "#7b1f1f" },
    tabText: { color: "#d6d6d6", fontSize: 13 },
    tabTextActive: { color: "#fff", fontWeight: "700" },
  });








  // const renderDrawerContent = () => {


  //   switch (drawerActiveTab) {
  //     case "Privacy&Security":
  //       return (
  //         <ScrollView style={settingsstyle.contentPane}>
  //           <Text style={settingsstyle.paneTitle}>Privacy & Security</Text>

  //           <View style={settingsstyle.row}>
  //             <Text style={settingsstyle.label}>Profile Visibility</Text>
  //             <Text style={settingsstyle.value}>{settings.profileVisibility}</Text>
  //           </View>

  //           <View style={settingsstyle.row}>
  //             <Text style={settingsstyle.label}>Two Factor Auth</Text>
  //             <Text style={settingsstyle.value}>{settings.twoFactorAuth ? "Enabled" : "Disabled"}</Text>
  //           </View>

  //           <View style={settingsstyle.row}>
  //             <Text style={settingsstyle.label}>Login Alerts</Text>
  //             <Text style={settingsstyle.value}>{settings.loginAlerts ? "On" : "Off"}</Text>
  //           </View>




  //           <TouchableOpacity style={settingsstyle.actionBtn} >
  //             <Text style={settingsstyle.actionBtnText}>Save Bio</Text>
  //           </TouchableOpacity>
  //         </ScrollView>
  //       );
  //     case "AccountSettings":
  //       return (
  //         <ScrollView style={settingsstyle.contentPane}>
  //           <Text style={settingsstyle.paneTitle}>Professional Information</Text>

  //           <Text style={settingsstyle.label}>Profession</Text>
  //           <Text style={settingsstyle.value}>{"—"}</Text>

  //           <Text style={settingsstyle.label}>Years of Experience</Text>
  //           <Text style={settingsstyle.value}>{"—"}</Text>

  //           <Text style={settingsstyle.label}>Projects Completed</Text>
  //           <Text style={settingsstyle.value}>{"—"}</Text>

  //           <TouchableOpacity style={settingsstyle.actionBtn}>
  //             <Text style={settingsstyle.actionBtnText}>Save Work Info</Text>
  //           </TouchableOpacity>
  //         </ScrollView>
  //       );
  //     case "notifications":
  //       return (
  //         <ScrollView style={settingsstyle.contentPane}>
  //           <Text style={settingsstyle.paneTitle}>Notifications</Text>

  //           <View style={settingsstyle.row}>
  //             <Text style={settingsstyle.label}>Push Notifications</Text>
  //             <Text style={settingsstyle.value}>{settings.pushNotifications ? "On" : "Off"}</Text>
  //           </View>

  //           <View style={settingsstyle.row}>
  //             <Text style={settingsstyle.label}>Email & SMS</Text>
  //             <Text style={settingsstyle.value}>{settings.emailNotifications ? "On" : "Off"}</Text>
  //           </View>

  //           <View style={settingsstyle.row}>
  //             <Text style={settingsstyle.label}>Notification Sounds</Text>
  //             <Text style={settingsstyle.value}>{settings.soundEnabled ? "On" : "Off"}</Text>
  //           </View>

  //           <TouchableOpacity style={settingsstyle.actionBtn}>
  //             <Text style={settingsstyle.actionBtnText}>{"Save Notifications"}</Text>
  //           </TouchableOpacity>
  //         </ScrollView>
  //       );

  //     case "Appearance":
  //       return (
  //         <ScrollView style={settingsstyle.contentPane}>
  //           <Text style={settingsstyle.paneTitle}>Appearance</Text>

  //           <View style={settingsstyle.row}>
  //             <Text style={settingsstyle.label}>Font Size</Text>
  //             <Text style={settingsstyle.value}>{settings.fontSize}</Text>
  //           </View>

  //           <View style={settingsstyle.row}>
  //             <Text style={settingsstyle.label}>Reduce Motion</Text>
  //             <Text style={settingsstyle.value}>{settings.reduceMotion ? "Yes" : "No"}</Text>
  //           </View>

  //           <View style={settingsstyle.row}>
  //             <Text style={settingsstyle.label}>Image & Video Quality</Text>
  //             <Text style={settingsstyle.value}>{settings.imageQuality}</Text>
  //           </View>

  //           <TouchableOpacity style={settingsstyle.actionBtn}>

  //             <Text style={settingsstyle.actionBtnText}>{"Save Appearance"}</Text>
  //           </TouchableOpacity>
  //         </ScrollView>
  //       );

  //     default:
  //       return (
  //         <View style={styles.contentPane}>
  //           <Text style={styles.paneTitle}>Unknown</Text>
  //         </View>
  //       );
  //   }
  // };



  // const settingsstyle = StyleSheet.create({
  //   safe: {
  //     overflow: 'hidden',
  //   },
  //   picker: {
  //     color: '#fff',
  //     ...(Platform.OS === 'ios' ? { height: 140 } : {}),
  //   },
  //   rowControl: {
  //     flexDirection: 'row',
  //     justifyContent: 'space-between',
  //     alignItems: 'center',
  //     marginTop: 6,
  //   },
  //   label: {
  //     color: '#fff',
  //     fontSize: 14,
  //   },
  //   helperText: {
  //     color: '#fff',
  //     opacity: 0.75,
  //     marginTop: 8,
  //     fontSize: 12,
  //   },
  //   textInput: {
  //     marginTop: 10,
  //     backgroundColor: '#121212',
  //     color: '#fff',
  //     borderRadius: 8,
  //     padding: 10,
  //     minHeight: 90,
  //     textAlignVertical: 'top',
  //   },
  //   actionRow: {
  //     flexDirection: 'row',
  //     justifyContent: 'space-between',
  //   },
  //   btn: {
  //     flex: 1,
  //     paddingVertical: 12,
  //     borderRadius: 10,
  //     alignItems: 'center',
  //     justifyContent: 'center',
  //     marginHorizontal: 6,
  //   },
  //   saveBtn: {
  //     backgroundColor: '#ff6b6b',
  //   },
  //   logoutBtn: {
  //     backgroundColor: '#fff',
  //   },
  //   btnText: {
  //     color: '#fff',
  //     fontWeight: '700',
  //   },



  //   drawerContent: { flex: 1, paddingHorizontal: 16, paddingVertical: 12 },
  //   contentPane: { paddingVertical: 8 },
  //   paneTitle: { color: "#fff", fontSize: 18, fontWeight: "700", marginBottom: 8 },
  //   paneText: { color: "#d6d6d6", fontSize: 14, lineHeight: 20 },
  //   row: { flexDirection: "row", justifyContent: "space-between", alignItems: "center", marginBottom: 12 },
  //   label: { color: "#d6d6d6", fontSize: 14 },
  //   value: { color: "#fff", fontSize: 14, fontWeight: "600" },
  //   actionBtn: { marginTop: 12, backgroundColor: "#7b1f1f", paddingVertical: 10, paddingHorizontal: 14, borderRadius: 8, alignItems: "center" },
  //   actionBtnText: { color: "#fff", fontWeight: "700" },
  // });

















  // Drawer component (full width)



  const Drawer = () => (
    <Animated.View
      style={[
        styles.drawerContainer,
        { transform: [{ translateX }] },
      ]}
      pointerEvents={isOpen ? "auto" : "none"}
    >
      <SafeAreaView style={styles.drawerSafe}>
        {/* TOP: header row with avatar + close button */}
        <View style={styles.drawerHeaderRow}>
          <View style={styles.drawerHeaderLeft}>
            <Image
              source={{ uri: "https://randomuser.me/api/portraits/men/32.jpg" }}
              style={styles.drawerAvatar}
            />
            <Text style={styles.drawerName}>Your Name</Text>
          </View>

          <TouchableOpacity onPress={closeDrawer} style={styles.closeBtn}>
            <Text style={styles.closeText}>✕</Text>
          </TouchableOpacity>
        </View>




        {/* Divider */}
        <View style={styles.divider} />

        {/* Content below (switch-case) */}
        <View style={styles.drawerContent}>{renderDrawerContent()}</View>




        <View style={styles.topNavWrap}>
          <ScrollView
            horizontal={true}
            showsHorizontalScrollIndicator={false}
            contentContainerStyle={styles.topNav}
          >
            {drawerNavItems.map((item) => {
              const active = item.key === drawerActiveTab;
              return (
                <Pressable
                  key={item.key}
                  onPress={() => setDrawerActiveTab(item.key)}
                  style={[styles.navItem, active && styles.navItemActive]}
                >
                  <View>
                    {item.icon || ""}
                  </View>
                  <Text style={[styles.navText, active && styles.navTextActive]}>
                    {item.label}
                  </Text>
                </Pressable>
              );
            })}
          </ScrollView>
        </View>



      </SafeAreaView>
    </Animated.View>
  );

  // No outside backdrop (drawer full-width), but keep a subtle overlay behind drawer when open to dim
  const Backdrop = () =>
    isOpen ? <Animated.View style={[styles.backdrop, { opacity: 0.35 }]} pointerEvents="none" /> : null;

  // App header shown at top of the screen (tabs header)
  const AppHeader = () => (
    <SafeAreaView style={styles.safeHeader} edges={["top"]}>
      <View style={styles.header}>
        <TouchableOpacity onPress={() => openDrawer()}>

          <MaterialCommunityIcons size={23} name="cog-outline" color={"#fff"} />

        </TouchableOpacity>

        <Text style={styles.title}>WICIKI</Text>

        <TouchableOpacity onPress={() => router.push("/profile")}>
          <Image
            source={{ uri: "https://randomuser.me/api/portraits/men/32.jpg" }}
            style={styles.avatar}
          />
        </TouchableOpacity>
      </View>
    </SafeAreaView>
  );

  return (
    <View style={{ flex: 1 }} {...panResponder.panHandlers}>
      {/* Drawer (full width) sits above everything */}
      <Drawer />
      <Backdrop />


      <Tabs
        screenOptions={{
          tabBarActiveTintColor: Colors[colorScheme ?? 'light'].tint,
          tabBarButton: HapticTab,
          header: AppHeader,
          tabBarStyle: {
            backgroundColor: "#000000ff",

            borderBottomColor: 'rgba(83, 74, 74, 0.1)',
          },
        }}

      >
        <Tabs.Screen
          name="index"
          options={{
            title: 'Home',
            tabBarIcon: ({ color }) => <MaterialCommunityIcons size={29} name="home-city" color={color} />,
          }}
        />
        <Tabs.Screen
          name="explore"
          options={{
            title: 'Reels',  //paperplane.fill
            tabBarIcon: ({ color }) => <MaterialCommunityIcons size={29} name="play-box-multiple" color={color} />,
          }}
        />
      </Tabs >
    </View>
  );
}

const styles = StyleSheet.create({
  // HEADER
  safeHeader: { backgroundColor: "#0b0b0b" },
  header: {
    height: 60,
    flexDirection: "row",
    justifyContent: "space-between",
    alignItems: "center",
    paddingHorizontal: 12,
    borderBottomWidth: 1,
    borderBottomColor: "rgba(255,255,255,0.1)",
  },
  title: { color: "#fff", fontSize: 18, fontWeight: "bold" },
  avatar: { width: 36, height: 36, borderRadius: 18 },

  // DRAWER (full screen width)
  drawerContainer: {
    position: "absolute",
    left: 0,
    top: 0,
    width: DRAWER_WIDTH,
    height: "100%",
    backgroundColor: "#010202ff",
    zIndex: 60,
    elevation: 60,
    shadowColor: "#000",
    shadowOpacity: 0.35,
    shadowRadius: 12,
    shadowOffset: { width: 0, height: 0 },
  },
  drawerSafe: { flex: 1 },

  // top header row inside drawer (avatar + close button)
  drawerHeaderRow: {
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "space-between",
    paddingHorizontal: 16,
    paddingTop: 12,
  },
  drawerHeaderLeft: { flexDirection: "row", alignItems: "center" },
  drawerAvatar: { width: 52, height: 52, borderRadius: 26, marginRight: 12 },
  drawerName: { color: "#fff", fontSize: 16, fontWeight: "700" },
  closeBtn: {
    padding: 8,
    borderRadius: 20,
    backgroundColor: "transparent",
  },
  closeText: { color: "#fff", fontSize: 20 },

  // horizontal nav
  topNavWrap: {
    width: "100%",
    paddingVertical: 7,
    backgroundColor: "#0a0a0a",
    position: "fixed",
    zIndex: 100,
    display: "flex",
    justifyContent: "center",
    alignItems: "center"
  },

  topNav: {
    flexGrow: 1,
    flexDirection: "row",
    overflowX: "scroll",
    alignItems: "center",
    justifyContent: "center",

  },

  navItem: {
    paddingVertical: 8,
    paddingHorizontal: 10,
    marginRight: 10,
    borderRadius: 20,
    display: "flex",
    flexDirection: "column",
    justifyContent: "center",
    alignItems: "center"
  },

  navItemActive: {
    backgroundColor: "rgba(117, 19, 19, 1)",

  },

  navText: {
    color: "#ccc",
    fontSize: 10,
  },

  navTextActive: {
    color: "#fff",
    fontWeight: "700",
  },

  divider: {
    height: 1,
    backgroundColor: "rgba(255,255,255,0.03)",
    marginHorizontal: 12,
    marginBottom: 8,
  },

  // drawer content area (below nav)
  drawerContent: {
    flex: 1,
    paddingHorizontal: 16,
    paddingVertical: 12,

  },
  contentPane: {
    paddingVertical: 8,
  },
  paneTitle: { color: "#fff", fontSize: 18, fontWeight: "700", marginBottom: 8 },
  paneText: { color: "#d6d6d6", fontSize: 14, lineHeight: 20 },

  // dark overlay behind drawer (pointerEvents none so it doesn't intercept touches)
  backdrop: {
    position: "absolute",
    left: 0,
    top: 0,
    width: SCREEN_WIDTH,
    height: "100%",
    backgroundColor: "#000",
    zIndex: 50,
    elevation: 50,
  },
});
